{"componentChunkName":"component---src-templates-post-template-js","path":"/vampires-and-zombies/","result":{"data":{"post":{"id":"743761b5-fe84-5294-a24f-751573676a45","html":"<p>It’s the spookiest time of year!\nYou might think spookiness and tech are unrelated, but you’d be wrong.\nWell, actually, you’d probably be right, but I’m not going to let that stop me writing Hallowe’en-themed <a href=\"/blood-curdling-tales-of-microservices-misadventure-devops-dread-and-grisly-governance-software-circus\">talks about getting cloud native wrong</a>, and Hallowe’en-themed talks about the <a href=\"/death-and-software\">importance of TestContainers cleanup logic</a>.</p>\n<p>This year, I’ve been thinking about zombies and vampires.\nZombies in movies are scary, but (spoiler) <em>they don’t exist</em>.\nSame for vampires.</p>\n<p>But in the tech world, these monsters do exist.\nAnd they’re pretty bad.\nMaybe not ripping-your-head off bad, but definitely bad enough to be worth exorcising.</p>\n<h2>Vampire code</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/405d431d1de356a07d7a053adc967c21/cac9f/vampire.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABBElEQVQoz4WRTUvDQBCG84e9qbeCXkSxeBCEikoUFEQJHhQtiGisWEQ86K1aiwkJpO2WBHOw5OuRDbE0kjQDw7A7wzvPu6swFUmSpDWOY3lgKAQ9wyAYjwnDMDdTFkqRoKzOYMDz5QUvRwe83ut4vj/pzRJV/l8kkg7whaCtnaLtq3T0W8IgyBOWiCrTdGlmgu5Tm+bGOiv1OtbOFsPW3WThLMpCy5LGOVR529vmRt3Fri1g1eb57nVzLqoJs0Hx0cFeW8ZubNLXjrFWlzAX53CumznKSkH5LnLM7b5jqg2MsxM+Hx8wWzpfV+f89J3Kjym0nNqOIlzPQ4xGRLKX5d/SMsu/UopiarZByugAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"a stick-figure vampire whose cape is covered in code\"\n        title=\"a stick-figure vampire whose cape is covered in code\"\n        src=\"/static/405d431d1de356a07d7a053adc967c21/5a190/vampire.png\"\n        srcset=\"/static/405d431d1de356a07d7a053adc967c21/772e8/vampire.png 200w,\n/static/405d431d1de356a07d7a053adc967c21/e17e5/vampire.png 400w,\n/static/405d431d1de356a07d7a053adc967c21/5a190/vampire.png 800w,\n/static/405d431d1de356a07d7a053adc967c21/c1b63/vampire.png 1200w,\n/static/405d431d1de356a07d7a053adc967c21/29007/vampire.png 1600w,\n/static/405d431d1de356a07d7a053adc967c21/cac9f/vampire.png 2207w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Let’s start off by talking about code.\nAs developers, we work really really hard to create code. So many of us assume code must be an asset.\nIt’s not.</p>\n<p>Code is a liability. Every bit of code we produce needs to be maintained.\nCode increases the attack surface of applications, creates cognitive load for developers, and slows down compilation. Ugh. Who’d want code?</p>\n<p>Martijn Verburg once said that he paid his junior developers by how much code they wrote, and his senior developers by how much code they deleted.\nPeople sometimes compare working with an LLM to pair programming with a very enthusiastic junior developer.\nThe model will get excited by your request and produce <em>as much code as it possibly can</em>.\nI suspect something in the mathematics of how these models are trained biases them towards verbosity. I saw this anecdotally when I generated a Quarkus application and 70% of the generated code was unnecessary.\nThe Hibernate with Panache libraries eliminate the need for boilerplate code, but the AI assistant put all the boilerplate in anyway.</p>\n<p>Statistical analysis of codebases seems to confirm my intuition. <a href=\"https://www.gitclear.com/coding_on_copilot_data_shows_ais_downward_pressure_on_code_quality\">A study by GitClear</a> found that codebases today have more duplicated code than they did before developers started using tools like CoPilot and ChatGPT.\nThey also found a reduction in the number of commits which deleted code.\nAs developers, we spend far more time reading code than writing code, so this excess code becomes an ongoing drain on developer time.</p>\n<p>Code can be vampire code even when it actually is needed in the codebase.\nAll but the smallest libraries usually include files and functions which a particular consumer application might not use.\nEven though they’re unused, these dormant bits of code still have a cost. They increase the size of the packaged application, which means increased network traffic for users.\nThis is extra bad for Javascript libraries, which will be downloaded every single time a web page loads.\nThe code bloat doesn’t just make page load slower, it uses energy.</p>\n<p>Extra code can also mean extra memory footprint; for example, the Java runtime will load unused database support classes into memory as part of the Hibernate bootstrap process. The classes will then be unloaded, but by then it’s too late; the peak memory requirement has been set high.</p>\n<p>Extra code can even slow applications down. For example, in Java, the process of invoking an interface method on an object is slower if multiple possible implementations exist on the classpath.\nIf the JVM has to choose between several implementations, that’s called megamorphic dispatching.\nIt’s slower than the single implementation case, monomorphic dispatching.</p>\n<p>The good news is that there is a solution.\nFor Javascript, where extra code has such an obvious bad impact, most modern build tooling will do a process called tree-shaking, which strips unused code.\nHistorically, Java did not have a similar process, but that’s now changing.\nFor example, building a GraalVM native binary will aggressively eliminate unused code.\nProject Leyden may also some tree-shaking ideas to the JVM itself.</p>\n<p>At a level above the runtime, the Quarkus architecture is designed to reduce vampire code.  Quarkus applies a number of build-time optimisations to applications, and libraries can participate in this optimisation process through extensions.<br>\nFor example, all of those undead database support classes in Hibernate?\nThe Quarkus Hibernate extension makes sure they never make it into the built application.\nThink of Quarkus’s build architecture as an extensible wooden stake.</p>\n<h2>Zombie servers</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/21bae1045eb94dd5113937b2ef82503f/fbd44/zombie.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA3klEQVQoz52Ry27CMBBF+f/P6Aew6aKCRVmA1CVRCAYBC5JKFRBq7KQ8bMCngrQivJTASKMZeWaO79gVbphz7uhZDtG4y2ckyI7cWf3SKvdBWTTG4rer9II39o6zWiEwD87bcOQxGPpora8uLq3QWotSczy/jui/0xE1wqj3PHA6/aLZqtH6eMHzX+kP6szi8K9vX27l0/tlAwslCToNRNAgjARpmjym8LJ5tVoSx5Ojm40p/JC7K/8PpalGKYnWCmM2heoKFa7XPyTJN1LGbLf2eWA+7nYWKWelYAfgL3zaD6iKfLXVAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"a stick-figure zombie that looks a bit like a server\"\n        title=\"a stick-figure zombie that looks a bit like a server\"\n        src=\"/static/21bae1045eb94dd5113937b2ef82503f/5a190/zombie.png\"\n        srcset=\"/static/21bae1045eb94dd5113937b2ef82503f/772e8/zombie.png 200w,\n/static/21bae1045eb94dd5113937b2ef82503f/e17e5/zombie.png 400w,\n/static/21bae1045eb94dd5113937b2ef82503f/5a190/zombie.png 800w,\n/static/21bae1045eb94dd5113937b2ef82503f/c1b63/zombie.png 1200w,\n/static/21bae1045eb94dd5113937b2ef82503f/29007/zombie.png 1600w,\n/static/21bae1045eb94dd5113937b2ef82503f/fbd44/zombie.png 2215w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Vampire code happens when a portion of an application’s codebase is unneeded.\nZombies happen when the <em>entire</em> application is unneeded.\nBy extension, not only is the application wasting resources, so is all the infrastructure running it.</p>\n<p>How could a whole application be unused?\nUsually, the root cause is forgetfulness: individual forgetfulness, and also organisational forgetfulness.\nIt may be that something was originally well-used, but then processes changed.\nOr perhaps a prototype was put into staging, and never progressed to production, but never got torn down, either.</p>\n<p>Over-provisioning also causes zombies.\nOrganisational incentive structures encourage over-provisioning,\nbecause no one wants to be the person who provisioned too little infrastructure and caused an outage.\nTo avoid this career-limiting situation, many people will err on the side of caution and configure far too much capacity.</p>\n<p>How bad is the zombie menace?\nIt’s bad.</p>\n<p><a href=\"https://www.nrdc.org/sites/default/files/data-center-efficiency-assessment-IB.pdf\">NRDC research</a> concluded that the average server was running at 12-18% of maximum capacity.\nThat wouldn’t be terrible, except a machine running with such low utilization still uses 30-60% of its maximum power. (This ratio is called “energy proportionality,” if you want to bring out the technical terms.)\nThings are even more disproportionate when we look at the hardware side. Building an unused server emits <em>exactly</em> the same amount of carbon and consumes the same amount of natural resources as building a well-utilised server. The cost to us and the planet is the same, but the value is far far lower.</p>\n<p>A <a href=\"https://www.anthesisgroup.com/wp-content/uploads/2019/11/Comatose-Servers-Redux-2017.pdf\">2017 survey</a> found that, over a six month period, 29% of servers had utilisation less than 5%.\nA quarter of the servers had no utilization at all; they were <em>completely unused</em>.</p>\n<p>That quarter figure is the average over a large sample, and included a number of different companies. In some unlucky organisations, the proportion of zombies can be higher.\nLike, much much higher.\n<em>Building Green Software</em> shares the story of a VMWare data centre in Singapore.\nThe data centre was being physically moved, and so before doing the move, the team checked what was running on the machines.\nRather incredibly, 66% of all the host machines were zombies. That’s a full-on <em>Twenty Eight Days Later</em> scenario, in which the zombies outnumber the value-creating machines.</p>\n<p>Hunting down zombie servers isn’t trivial; kind of by definition, forgotten servers are hard to find.\nThe reason VMWare discovered them was because the physical move forced a virtual clear-out.\nOtherwise, who knows how long the useless servers might have hung around?\nRegular audits of an estate can help, but, regrettably, they are pretty boring to execute.\nAs a more intellectually rewarding alternative, consider deploying elastic scaling solution, or even fully-fledged autonomic resource optimisation.\nInfrastructure-as-code can help make it easier to keep tabs on what’s being run, and ephemeral leasing can help hurry the release of systems which aren’t actually needed anymore.</p>\n<p>Vampire code and zombie servers are, fundamentally, wasteful.\nThey use resources and have no value.\nThat waste costs us money, but it also threatens the planet.\nWhy not organise a few trick-or-treating expeditions to hunt down those under-utilized servers and useless lines of code?</p>","excerpt":"It’s the spookiest time of year!\nYou might think spookiness and tech are unrelated, but you’d be wrong.\nWell, actually, you’d probably be…","fields":{"title":"Zombie Menace, Vampire Peril","slug":"/vampires-and-zombies/","prefix":"2024-10-16","shortDate":"10-16","category":"sustainability","author":"holly cummins","displayCategory":"sustainability","geography":null,"video":null,"slides":null,"oembeds":null,"cover":{"childImageSharp":{"resize":{"src":"/static/405d431d1de356a07d7a053adc967c21/630fb/vampire.png"}}}},"frontmatter":{"type":"blog","event":null,"keynote":null,"code":null,"resources":null}},"authornote":{"id":"77e0dd69-1df1-59df-9a8e-f3f29c267627","html":"<p><strong>Holly Cummins</strong>. Holly Cummins is a Senior Principal Software Engineer at Red Hat, in the Quarkus Team. She is a\nkeynote speaker, author, and bad illustrator.</p>"}},"pageContext":{"slug":"/vampires-and-zombies/","prev":{"id":"02b4419e-d128-5a3f-b86f-b42f57ac122a","fields":{"slug":"/productivity-messing-around-devoxx-be/","prefix":"2024-10-10","draft":null,"source":"talks","category":"fun"},"frontmatter":{"title":"Productivity is Messing Around and Having Fun","url":null,"type":"talk"}},"next":{"id":"6ef0a325-b260-5a5a-93b7-f58108bb097d","fields":{"slug":"/jobs-harder-easier-voxxed-thessaloniki/","prefix":"2024-10-19","draft":null,"source":"talks","category":"software-development"},"frontmatter":{"title":"The future of development – Are our jobs getting harder or easier?","url":null,"type":"talk"}},"source":"posts"}},"staticQueryHashes":["1862184931","421231837","835725211"]}