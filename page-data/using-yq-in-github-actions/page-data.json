{"componentChunkName":"component---src-templates-post-template-js","path":"/using-yq-in-github-actions/","result":{"data":{"post":{"id":"19a131ee-5ee2-578d-9224-9cbe743cab5b","html":"<p>TLDR: GitHub runners come with yq pre-installed. There’s no need to install it, or use a third-party action.</p>\n<p>A problem of modern search engines is that it’s much easier to index the presence of something than the absence of it.\n(LLMs have this problem too, which is why ChatGPT will sometimes misunderstand a programming model and generate pages of unnecessary boilerplate.)</p>\n<p>I recently used <a href=\"https://mikefarah.gitbook.io/yq\">yq</a> to alphabetise an array in a yaml document.\nI wanted to run my script after every commit to a GitHub repo, but I didn’t know if <code class=\"language-text\">yq</code> would be installed on the GitHub runners.\nSo I googled “yq github actions,” as one does*.</p>\n<p>The result was lots of marketplace actions for installing it.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/12ab62d9d64b8e1c9b7ebfaca38219f4/0d721/search-results.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABrklEQVR42p1SS27bMBT0vpdo9/Ul0uQWvoEAA1rpCrpNb9FNDWRju7aBIAkkKPrQlERSP/5eH6nUBdqkbfqgwTyS0mjeSIv729v3j4/f4jzLEVmcpmmcIWdZ6ZHn5DfMZyQuS4prGreUxqqj8eFw+LDY7XbXgKW1cWStsb639geD7w3uG7fwN8HMz1S2Gr7eKTidTjdO8JPB58qi0M2ZKKmk5oJppZQ2xmgU067wQOPl934Cz9Sk7jKhP38h9ng8Xl8c0opBel/aIqVQZTVwJkDKCcZx9MAXwCtlZ9cW9vv9zUWQcwHnM7VDP8AwjDBJiSNrFJUwTZPvXxN0ikr/ItgQDujO1hUHWjAQvAdtNLhM/1IvO2xqDqSqreADjtujS3Q6zk7/S7AsGTw8FDZJKkiSM3Rdj9lNXrjHGMz8F/y7oBACmraxfd/7vIz79NZ4nnv7NkFCBDqjtsD88rxFMIxheLvgZrO5QleaEKqS5ElmT4WqKqrahqu6Zopxrhjjqus6heO/BOkYJ9Tb7fZqsVqt3q3X649RFC6jKFg6DqNoGYYBIrwgCII/wmk4re9a31PghvLm2wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"a page of search results for marketplace actions\"\n        title=\"\"\n        src=\"/static/12ab62d9d64b8e1c9b7ebfaca38219f4/5a190/search-results.png\"\n        srcset=\"/static/12ab62d9d64b8e1c9b7ebfaca38219f4/772e8/search-results.png 200w,\n/static/12ab62d9d64b8e1c9b7ebfaca38219f4/e17e5/search-results.png 400w,\n/static/12ab62d9d64b8e1c9b7ebfaca38219f4/5a190/search-results.png 800w,\n/static/12ab62d9d64b8e1c9b7ebfaca38219f4/c1b63/search-results.png 1200w,\n/static/12ab62d9d64b8e1c9b7ebfaca38219f4/29007/search-results.png 1600w,\n/static/12ab62d9d64b8e1c9b7ebfaca38219f4/0d721/search-results.png 2774w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>There was a featured snippet for “is yq available on GitHub actions,” which directed me to a marketplace installer.\nThe yq project itself had a marketplace installer. Clearly, I needed to install it before using it. Right?</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/30dd49565f1f0694f75a838c2915840f/0c3d0/snippet.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABOklEQVR42p1R2U7DMBDM//8Rz0DFUUorKAJ656odx0lIvLaTNhmctOIRFSyNdu09Z+wZYxCGIRhj4JwjSRIcDgf893h9ccKZaxgPVogEpBSM0X9qXDcN2q6Dp92Ge5bADyIEEUMQc2z9GJtdBCELKF2jVBYVWZBpoKg+v5kz7CmuNNq2hSdywtVoheuJj9l7iMncx+QtGOzddInb8SdGTws8zDYYv2wxft05fz3g5vEDd89L3E/XkFl5olxWhNl8hcU6QBQGKIoc1pqBstYa1jEgchKcfaUqJ0nl7oSqqlwODfl1XZ8aNo57nstBwz7Yr310aLt28Ht0TpuLP4Ucdxal4PsUgmfIROmsGxBJpLxAEmeQ/AuNPf4U/TbAa0wL6RNK4YSVFqmvQEUDGRJkRBA7Bb4pkTN90YbfyRxmQhd5y3MAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"a github answer for Is yq available in GitHub Actions?\"\n        title=\"\"\n        src=\"/static/30dd49565f1f0694f75a838c2915840f/5a190/snippet.png\"\n        srcset=\"/static/30dd49565f1f0694f75a838c2915840f/772e8/snippet.png 200w,\n/static/30dd49565f1f0694f75a838c2915840f/e17e5/snippet.png 400w,\n/static/30dd49565f1f0694f75a838c2915840f/5a190/snippet.png 800w,\n/static/30dd49565f1f0694f75a838c2915840f/c1b63/snippet.png 1200w,\n/static/30dd49565f1f0694f75a838c2915840f/0c3d0/snippet.png 1414w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>I wrote my workflow, using the action from the yq project itself, and sent it off to review. My colleague George Gastaldi looked at what I’d done, and pointed out yq was available on the runners. This matters, because we try and limit our use of external, ‘non-official’ actions, for supply chain security reasons.</p>\n<p>So I searched again to confirm, and … still found very little. To actually confirm, I had to merge and experiment.\nAnd, indeed, the GitHub runners do come with yq pre-installed. They’ve had <code class=\"language-text\">yq</code> since 2021.</p>\n<p>This is the workflow step which alphabetises an antora playbook:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Alphabetise\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          yq '.content.sources |= sort_by(.url)' antora-playbook.yml > antora-playbook-sorted.yml\n          mv antora-playbook-sorted.yml antora-playbook.yml</span></code></pre></div>\n<p>I’m hoping this blog can help the next person who might be trying to figure out how to use yq with GitHub Actions.\nFor everyone else, please appreciate my attempt to illustrate ‘yaml,’ by combining a yak and lots of marks and language.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4bc900fffca303316546bf47c02180a9/09ede/yak.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB/ElEQVR42o2TbY/SQBSF+f9/wC8munHNxriIIBQqS9e2wrZQW6BCoWxLd2GBAgHCW8vrcaYIqFmNJ5lkOnP73HNn7oQmkwkGg0Ew6Hy73YJqv9/jOdH1X/f+jAuNRiN4nofFYoHpdIpOp4PVaoXZbHaCD/ouakYV4/EIu90uWNuRPY/ErTeb34E0w4Ys+r4fBFMwTSIKAuZk3m63wIWvYMki2GQC4m0GRqWMsqrgu5xFUc5hOBye3IaWy2UAWq/XAZS6ogGmaULgeYg3KdQLWahZHkw0jGrhKxriDRqSAEfNoZkXoSr5wFTgsNvtBhA6jqX3SYn026jo4JgYKmoemcRH6GIaTlEibvkAWv+SRDvLQZdEPD21D8D5fA7XdYPR7/fJOY3RarVgGAZosgwTRVXJQsvdwubisAoCHqsqbAK/51Owhc+wizLMmnEAHmunjo4HTkXhvV4PkXdvwTMR8jMLI/WBOGPRZKOwNQkPpFwnHYNdVqDk5fOlPN8eB7heKuHi5QsMCKCZuEaHOHKLebi1Mh7qOhyjhEwyBunu7uzwb/1G5ZGLSibi0Mg5Nb5JUDkWmiIjHY8gcvUGTCyCdJI5tw3+oSO07di4vnyNy4tXEEUBlmXhU/g97EYduqbg3jTObYP/kE9un7bUbDY9JfFJU1PRdtv8fADU4Q88nyyzacrvTQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"a yak covered in marks\"\n        title=\"\"\n        src=\"/static/4bc900fffca303316546bf47c02180a9/5a190/yak.png\"\n        srcset=\"/static/4bc900fffca303316546bf47c02180a9/772e8/yak.png 200w,\n/static/4bc900fffca303316546bf47c02180a9/e17e5/yak.png 400w,\n/static/4bc900fffca303316546bf47c02180a9/5a190/yak.png 800w,\n/static/4bc900fffca303316546bf47c02180a9/c1b63/yak.png 1200w,\n/static/4bc900fffca303316546bf47c02180a9/29007/yak.png 1600w,\n/static/4bc900fffca303316546bf47c02180a9/09ede/yak.png 1710w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>In hindsight, I perhaps should have been more precise and searched for “yq github runner,” but even if I had, the results are pretty much the same.</li>\n</ul>","excerpt":"TLDR: GitHub runners come with yq pre-installed. There’s no need to install it, or use a third-party action. A problem of modern search…","fields":{"title":"Using yq in GitHub Actions","slug":"/using-yq-in-github-actions/","prefix":"2024-08-09","shortDate":"08-09","category":"devops","author":"holly cummins","displayCategory":"devops","geography":null,"video":null,"slides":null,"oembeds":null,"cover":{"childImageSharp":{"resize":{"src":"/static/4bc900fffca303316546bf47c02180a9/630fb/yak.png"}}}},"frontmatter":{"type":"blog","event":null,"keynote":null,"code":null,"resources":null}},"authornote":{"id":"77e0dd69-1df1-59df-9a8e-f3f29c267627","html":"<p><strong>Holly Cummins</strong>. Holly Cummins is a Senior Principal Software Engineer at Red Hat, in the Quarkus Team. She is a\nkeynote speaker, author, and bad illustrator.</p>"}},"pageContext":{"slug":"/using-yq-in-github-actions/","prev":{"id":"ef6d26e9-7d25-5d93-9c0c-1b87bce22cf8","fields":{"slug":"/productivity-messing-around-dpe-london/","prefix":"2024-06-25","draft":null,"source":"talks","category":"fun"},"frontmatter":{"title":"Productivity is Messing Around and Having Fun","url":null,"type":"talk"}},"next":{"id":"5b7e3dae-5b6e-5e87-8792-32e02ff7d5f2","fields":{"slug":"/quarkus-insights-extensions/","prefix":"2024-08-12","draft":null,"source":"talks","category":"quarkus"},"frontmatter":{"title":"How to create your own Quarkus extension","url":null,"type":"talk"}},"source":"posts"}},"staticQueryHashes":["1862184931","2262979903","421231837"],"slicesMap":{}}